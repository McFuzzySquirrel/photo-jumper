---
session_id: ejs-session-2026-02-06-006
author: GitHub Copilot (Claude Opus 4.6) + McFuzzySquirrel
date: 2026-02-06
repo: McFuzzySquirrel/photo-jumper
branch: feature/smart-walls-camera-letterbox
agents_involved:
  - GitHub Copilot (Claude Opus 4.6)
decision_detected: true
adr_links: []
tags:
  - fill-zoom
  - shadows
  - frosted-glass
  - letterbox
  - game-logo
  - branding
  - visual-polish
refs:
  - Branch: feature/smart-walls-camera-letterbox
  - Parent commit: 073c7d3 (session-005)
  - Commit: 6449f4a
---

# Problem / Intent

**User Report**: After session-005 changes, the image scale "worked better before" â€” the photo didn't fill the screen properly. Additionally:
1. Platform shadows visually obscure jump clearance (even though they don't affect collision)
2. A new game image (`images/photo-jumper-sq.png`) was available for branding
3. The blank letterbox area could use the game image as a frosted-glass background

**Session Goals**:
1. Fix image scaling by switching from "fit" zoom to "fill" zoom
2. Remove platform shadows (keep goal glow and player shadow)
3. Add frosted-glass letterbox using game image as CSS background
4. Add game logo to intro and game screens

# Interaction Summary (Required)

## Research Phase
- **Agent**: Dispatched subagent investigating image scaling, shadow rendering, welcome screen HTML, and canvas sizing
- **Key Finding**: `autoFitZoom` used `Math.min(zoomToFitWidth, zoomToFitHeight)` which shows the entire photo with letterbox. `Math.max` (fill) would make the photo fill the viewport with camera panning â€” matching the pre-refactor feel.
- **Key Finding**: Platform shadows are already non-collidable (purely visual `fillRect` inside `draw()`) but visually suggest blocks are larger than their hitbox.
- **Key Finding**: Fullscreen CSS `width: 100%; height: 100%` (from session-005) may stretch the canvas buffer.

## Planning Phase
- **Agent**: Proposed 6 changes: fill zoom, revert fullscreen CSS, remove shadows, frosted letterbox, game image on intro, game image on game screen
- **Human**: "Fill zoom, use CSS approach with blur/frosted and put game image on game screen too"
- **Agent**: Refined plan with CSS `::before` pseudo-element approach and logo on both screens
- **Human**: "Happy with the considerations"

## Implementation Phase
- **Human**: "Start implementation"
- **Agent**: Applied all 6 changes via multi-replace (all succeeded), zero errors
- **Outcome**: Committed as `6449f4a`

# Agent Collaboration Summary

**Key Prompts Used**:
- Subagent research for image scaling, shadow rendering, and welcome screen structure
- Multi-replace batch for all 6 edits

**Key Suggestions**:
- Fill zoom (`Math.max`) vs fit zoom (`Math.min`) â€” fill matches platformer expectation
- CSS `::before` pseudo-element for frosted glass (GPU-composited, no per-frame cost)
- `inset: -20px` on pseudo-element to prevent blur edge artifacts
- Revert fullscreen canvas CSS to `auto` for aspect ratio preservation
- Two logo sizes: `.game-logo` (200px intro) and `.game-logo-sm` (80px inline game screen)

**Corrections Required**:
- None â€” all proposals accepted as-is

# Agent Influence (Required)

**Suggestions Adopted**:
- Fill zoom as default (agent proposed, user confirmed "fill zoom")
- CSS `::before` approach for frosted glass (agent proposed CSS vs canvas, user picked CSS)
- Game logo on both screens (user requested "game screen too")
- Revert fullscreen canvas CSS to `max-width/max-height auto` (agent recommendation)
- Remove platform shadows but keep goal glow + player shadow (agent distinction)

**Suggestions Rejected**:
- None

**Human Overrides / Corrections**:
- User explicitly requested game image on game screen (agent had it as "further consideration")

# Experiments / Evidence

**Experiment 1: Shadow Collision Analysis**
- **Tried**: Traced shadow rendering vs collision bounds
- **Result**: Shadows are purely visual `fillRect` calls with +2px offset inside `draw()`. `checkCollision()` uses only `platform.x/y/width/height` â€” shadows never affect collision.
- **Evidence**: But visually, the shadow extends the perceived block size, creating false clearance impressions.

**Experiment 2: Fit vs Fill Zoom**
- **Tried**: Analyzed `Math.min` (fit) vs `Math.max` (fill) for `autoFitZoom`
- **Result**: Fit shows entire photo with letterbox bars. Fill makes photo fill the viewport, requiring camera panning â€” standard for platformers.
- **Evidence**: User reported "worked better before" â€” the pre-refactor version used a different zoom that filled the screen.

# Iteration Log

**Iteration 1: Initial shadow proposal**
- Agent initially proposed making shadows non-collidable
- Research showed they already ARE non-collidable
- Pivoted to removing them entirely since they visually mislead about clearance

**Iteration 2: Letterbox approach**
- Agent proposed CSS `::before` and canvas `drawImage` options
- CSS approach chosen: GPU-composited, no per-frame cost, simpler code
- `blur(20px) brightness(0.3)` for frosted-glass effect

# Decisions Made

**Decision 1: Fill Zoom Default**
- **Reason**: Fit zoom showed letterbox bars; fill zoom makes the photo fill the viewport like a typical platformer. Camera pans to show content. Player can still zoom out with `-` or `0`.
- **Impact**: `autoFitZoom = Math.max(zoomToFitWidth, zoomToFitHeight)`. `minZoom` still based on `Math.min` for full-level view.

**Decision 2: Remove Platform Shadows**
- **Reason**: Shadows were visually misleading â€” suggested blocks were larger than their collision bounds, creating false clearance impressions even though collision was unaffected.
- **Impact**: Cleaner visual. Goal glow and player shadow kept for gameplay clarity.

**Decision 3: CSS Frosted-Glass Letterbox**
- **Reason**: Per-frame canvas `drawImage` for a 2.3MB image would be expensive. CSS `::before` with `background-size: cover` is GPU-composited and cached.
- **Impact**: `::before` pseudo-element with `blur(20px) brightness(0.3)`, `z-index: 0`. Canvas at `z-index: 1`. Fallback `#1a1a2e` background.

**Decision 4: Revert Fullscreen Canvas CSS**
- **Reason**: `width: 100%; height: 100%` (from session-005) could stretch the canvas. `max-width: 100vw; max-height: 100vh; width: auto; height: auto` preserves the buffer's intrinsic aspect ratio.
- **Impact**: Canvas display size matches buffer dimensions without distortion.

**Decision 5: Game Logo Branding**
- **Reason**: Emoji `ðŸŽ®` was generic. The new game image adds visual identity.
- **Impact**: `.game-logo` (200px, centered) on intro screen. `.game-logo-sm` (80px, inline) on game screen heading.

# Key Learnings

**Technical Insights**:
- `Math.min` (fit) vs `Math.max` (fill) for zoom: fit shows everything with letterbox, fill covers the viewport with panning. Platformers want fill â€” you don't need to see the whole level at once.
- CSS `::before` pseudo-element with `filter: blur()` is the right way to add frosted glass effects without affecting child elements. `inset: -20px` prevents blur edge artifacts.
- Canvas `width: auto; height: auto` preserves intrinsic aspect ratio from the buffer. `width: 100%; height: 100%` stretches to fill the container regardless of buffer aspect ratio.
- Visual-only rendering artifacts (shadows) can mislead players even when collision is unaffected â€” visual and collision alignment matters for trust.

**Process Insights**:
- Three sessions (004, 005, 006) on the same branch, each refining the previous. Iterative improvement works well when each session has a clear focus.
- User's "worked better before" feedback is a strong signal â€” always compare against the previous state.

# If Repeating This Work

**Do This**:
- Use `Math.max` (fill) for default zoom in platformers
- Use CSS pseudo-elements for background effects (GPU-composited, no per-frame cost)
- Use `max-width/max-height` with `auto` dimensions for aspect-ratio-preserving canvas display
- Always verify shadow/visual effects don't mislead about collision bounds

**Avoid This**:
- `width: 100%; height: 100%` on canvas when aspect ratio matters
- Canvas `drawImage` per frame for static background effects (use CSS instead)
- `Math.min` (fit) zoom as default for platformers (shows too much, feels zoomed out)

**Watch Out For**:
- Blur filter edge artifacts â€” use `inset: -20px` or similar overflow on the pseudo-element
- z-index stacking: pseudo-element at `z-index: 0`, canvas at `z-index: 1`
- Large image files (2.3MB) are fine for CSS backgrounds (loaded once, cached) but expensive for per-frame canvas rendering

# Future Agent Guidance

**Prefer**:
- Fill zoom for platformer default; fit zoom as minimum zoom for "see whole level"
- CSS `::before`/`::after` for background visual effects
- `max-width/max-height` with `auto` for canvas display sizing
- Visual and collision alignment (what you see = what you collide with)

**Avoid**:
- `width/height: 100%` on canvas elements
- Per-frame canvas rendering of large static images
- Platform shadows or visual elements that extend perceived hitbox

## MACHINE EXTRACTS

### INTERACTION_EXTRACT
```
1. RESEARCH:
   - Agent: Investigated zoom (Math.min fit vs Math.max fill), shadows (visual only),
     canvas CSS (100% stretches), welcome screen HTML
   - User: "Lost the image scale, worked better before"

2. PLANNING:
   - Agent: 6 changes â€” fill zoom, revert CSS, remove shadows, frosted letterbox, logo x2
   - User: "Fill zoom, CSS approach, game image on game screen too"

3. IMPLEMENTATION:
   - 6 multi-replace operations, all succeeded, zero errors
   - Committed as 6449f4a
```

### DECISIONS_EXTRACT
```
- FILL_ZOOM: Math.max for autoFitZoom (photo fills viewport, camera pans)
  Reason: Fit zoom felt zoomed out; fill matches platformer expectation
  Impact: minZoom still allows full-level view

- REMOVE_SHADOWS: Delete platform shadow fillRect
  Reason: Visually misleading about collision bounds
  Impact: Cleaner blocks; goal glow + player shadow kept

- CSS_FROSTED_GLASS: ::before pseudo-element with blur+darken
  Reason: GPU-composited, no per-frame cost vs canvas drawImage
  Impact: Frosted game image behind canvas, #1a1a2e fallback

- REVERT_CANVAS_CSS: Back to max-width/max-height auto
  Reason: width:100%;height:100% stretches canvas
  Impact: Canvas preserves buffer aspect ratio

- GAME_LOGO: photo-jumper-sq.png on intro (200px) and game (80px) screens
  Reason: Replace generic emoji with actual game branding
  Impact: .game-logo and .game-logo-sm CSS classes
```

### LEARNING_EXTRACT
```
Technical:
- Math.min=fit (letterbox), Math.max=fill (panning) for zoom
- CSS ::before with filter:blur() doesn't affect child elements
- Canvas width:auto preserves aspect ratio; width:100% stretches
- Visual shadows mislead about collision even when non-collidable

Process:
- "Worked better before" = compare against previous state
- Iterative refinement across sessions (004â†’005â†’006) works well
- CSS approach > canvas approach for static visual effects
```

### AGENT_GUIDANCE_EXTRACT
```
PREFER:
- Fill zoom (Math.max) for platformer defaults
- CSS pseudo-elements for background effects
- max-width/max-height with auto for canvas display
- Visual-collision alignment

AVOID:
- width/height:100% on canvas elements
- Per-frame canvas rendering of static images
- Visual elements that extend perceived hitbox beyond collision bounds
```
