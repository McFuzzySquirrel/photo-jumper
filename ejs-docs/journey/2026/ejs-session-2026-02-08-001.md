session_id: ejs-session-2026-02-08-001
author: GitHub Copilot
date: 2026-02-08
repo: photo-jumper
branch: ml-primary-architecture
agents_involved: ["GitHub Copilot"]
decision_detected: true
adr_links: []
tags: ["collision", "platform-thickness", "visuals"]
refs: ["js/main.js", "js/engine/player.js", "js/engine/platform.js"]

# Problem / Intent
Resolve invisible platform collisions and double-thick platform visuals; close out the EJS session.

# Interaction Summary (Required)
- Human: Reported invisible collisions and asked if wall blocks should be collidable again for assist.
  - Agent: Re-enabled wall collisions, left shadow blocks visual-only, and made platform rendering draw full height (no hidden collision). Adjusted rendering order for shadows.
  - Outcome: Collisions mapped to real geometry; visual layers matched collision better.
- Human: Confirmed collisions traced to 2-block thickness; requested one-block platforms.
  - Agent: Normalized platform height to one block and then fixed double-scaling by switching platform generation to process-space block sizing before scaling to world space.
  - Outcome: Platform thickness and overlays corrected; visuals match collision again.
- Human: Confirmed fix and requested wrap-up with future plan (ML-only + max 2-block helpers).
  - Agent: Documented session and noted next-step intent.
  - Outcome: EJS session closed with next-step direction captured.

# Agent Collaboration Summary
Key prompts used
- "nope, that invisible layer is still there"
- "platforms seem to be 2 blocks thick"
- "lets wrapup this session and close out ejs"
Key suggestions
- Re-enable wall blocks for assist while keeping shadows non-colliding.
- Normalize platform height to one block after scaling.
- Fix double-scaling by using process-space block sizes for platform generation.
Corrections required
- Adjusted process-space scaling after visual still appeared 2 blocks thick.

# Agent Influence (Required)
Where did the agent influence the outcome?
- Suggestions adopted:
  - Use process-space block sizing for all platform generation before scaling to world space.
  - Render full platform height in `Platform.draw()` to prevent hidden collision layers.
- Suggestions rejected (and why):
  - None.
- Human overrides / corrections:
  - Reintroduced collidable wall blocks for assist rather than keeping all walls visual-only.

# Experiments / Evidence
What was tried?
- Separated shadow blocks from collidable platforms and rendered them first.
- Re-enabled wall blocks for assist and removed their collision skip.
- Normalized platform height and then corrected process-space scaling.
What happened?
- Invisible collision layer resolved after fixing double-scaling and height normalization.
What evidence changed your mind?
- Visuals still appeared 2 blocks thick after initial normalization, indicating scaling mismatch.

# Iteration Log
- Restored wall collisions while keeping shadows visual-only.
- Updated `Platform.draw()` to render full height.
- Added one-block height normalization after scaling.
- Switched platform generation to process-space block sizing (grid, ML, fallbacks, helpers, walls, ground/start).

# Decisions Made
- Decision: Use process-space block sizing for platform generation before world scaling.
  - Reason: Avoid double-scaling that inflated platform thickness.
  - Impact: Platforms render at one-block thickness consistent with collision.

# Key Learnings
Technical insights
- Mixing process-space generation with world-space block sizes causes double-scaling artifacts.
- Platform rendering must respect actual platform height to avoid invisible collision layers.
Prompting insights
- Visual screenshots quickly verify collision/geometry mismatches.
Tooling insights
- None.

# If Repeating This Work
Do this:
- Define block sizes in the same coordinate space as platform generation.
Avoid this:
- Applying world-space scaling before generation and again after.
Watch out for:
- Helper/wall placement using mismatched block sizes.

# Future Agent Guidance
Prefer:
- ML-only mode with helper platforms capped at 2-block width for gap bridging (requested next step).
Avoid:
- Reintroducing grid platforms when ML-only is intended.

## MACHINE EXTRACTS

### INTERACTION_EXTRACT
- Human reported invisible collisions and 2-block platform thickness; agent corrected wall/shadow collision and fixed scaling.

### DECISIONS_EXTRACT
- Use process-space block sizing for platform generation to prevent double-scaling.

### LEARNING_EXTRACT
- Platform height rendering must align with collision height to avoid invisible layers.

### AGENT_GUIDANCE_EXTRACT
- For ML-only mode, keep helper platforms to max 2 blocks wide for gap bridging.
